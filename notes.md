# システム構成

## モジュール
1. リポジトリ解析モジュール
   - 入力：リポジトリ情報、出力：解析済のリポジトリ情報(json形式？)
   - LangChainのGitloader(RAG)、Gitpythonなどを利用してリポジトリの情報を抽出
   - プロジェクトディレクトリから依存関係、環境設定、関連ドキュメントなど、ビルドに関連する主要な情報を自動的に抽出(ビルド、テストのワークフロー生成をメインに考える)
   - この解析もLLMにやらせるのもあり？
2. ワークフロー生成モジュール
   - 入力：解析済のリポジトリ情報、出力：ymlファイル
   - ワークフローをLLMに生成させる
   - プロンプトの設計、RAG(GitHub Actionsの公式ドキュメントを利用する？)、エージェントなどの工夫
   - 構文エラーや脆弱性のチェックに関しても動的にLLMに判断させ、修正を繰り返せるようにしたい(実際に実行→ログ解析→修正を繰り返すLLMエージェントを構築)
   - キャッシュやpathなどの簡単な最適化も導入したい
3. 解説文生成モジュール
   - 入力：ymlファイル、出力：mdファイル
   - ymlファイルの内容を解説、初学者の理解支援
   - 書き方だけでなく、こう書くことによるメリットまで伝えられるように

### 思いつきメモ
- 8/14
  - [CXXCrafterの論文](https://www.notion.so/CXXCrafter-C-C-LLM-2334fab72b5281cb90b9fc20d21e0c2d)を参考にするといいかも
    - ワークフロー生成モジュールを、入力の情報に基づき、ワークフローを生成するモジュールと、生成されたワークフローを実行し、エラーや脆弱性の解析をしてその結果を返すモジュールに分けた方が良さそう
    - 生成モジュールではLLMが前回どのように生成したのかを覚えていた方が同じミスしなくなって精度上がりそう？、最近生成したワークフローファイルとその実行結果を保持するモジュールがあってもいい
  - 解説文には、パッケージなどが依存関係などの関係で最新のものでない可能性とかあるから、それらの説明の入れたらいいかも？
  - プロジェクトでは複数のビルドシステムが利用されていることがあるようなので、リポジトリ解析の際にどのビルドシステムを利用するかをLLMに判断させる？もしくはそれぞれ生成してみて、エラーない方にするとか？
- 8/16
  - プロンプトについて
    - テンプレート+プレースホルダー(プロジェクトによって変更)にする
    - ワークフローファイルの書き方や手順なども書く
    - プロジェクトの環境、依存関係、RAGの外部情報などをプレースホルダーで埋め込む
- 8/18
  - 実行ログをLLMに渡して、原因、修正案を出力、これを保存しておき、毎回のLLMの入力に渡せば修正内容の重複は解決できる(ログ自体膨大すぎるからこれを毎回渡すのはトークンが増えすぎる)
  - 最終的には、ワークフロー実行などは別ブランチで実行して、プルリクの流れにしたい
- 8/22
  - (8/14)生成モジュールではLLMが前回どのように生成したのかを覚えていた方が同じミスしなくなって精度上がりそう？、最近生成したワークフローファイルとその実行結果を保持するモジュールがあってもいい
  → これはLangGraphのステートやチェックポイント使えばできそう
  →トークン数が増えて大変そうだから何か工夫が必要
- 8/24
  - LangChainの`with_structured_output()`を使うことで、LLMの出力を引数の型に構造化して返すよう設定できるのを利用する
  - LangGraphやLCELを利用してモジュールを繋ぐ
- 9/4
  - ワークフロー生成において
    - ビルドとテストは分けてキャッシュなどを導入する
    - 